<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Provides extension types and conversions to between R-native
  object types and Arrow columnar types.">
<title>Extension types for geospatial data for use with Arrow • geoarrow</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Extension types for geospatial data for use with Arrow">
<meta property="og:description" content="Provides extension types and conversions to between R-native
  object types and Arrow columnar types.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">geoarrow</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="geoarrow">geoarrow<a class="anchor" aria-label="anchor" href="#geoarrow"></a>
</h1></div>
<!-- badges: start -->

<p>The goal of geoarrow is to prototype Arrow representations of geometry. This is currently a <a href="https://github.com/jorisvandenbossche/geo-arrow-spec/blob/geo-arrow-format-initial/format.md" class="external-link">first-draft specification</a> and nothing here should be used for anything except entertainment value.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"paleolimbot/geoarrow"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="write-and-write-to-parquet">Write and write to Parquet<a class="anchor" aria-label="anchor" href="#write-and-write-to-parquet"></a>
</h2>
<p>This exists for prototyping only, but should work with most things that you throw at it. Notably, sf objects should work out-of-the-box.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://paleolimbot.github.io/geoarrow/">geoarrow</a></span><span class="op">)</span>

<span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu">read_sf</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shape/nc.shp"</span>, package <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="reference/write_geoarrow_parquet.html">write_geoarrow_parquet</a></span><span class="op">(</span><span class="va">nc</span>, <span class="st">"nc.parquet"</span><span class="op">)</span>
<span class="fu">sf</span><span class="fu">::</span><span class="fu">st_as_sf</span><span class="op">(</span><span class="fu"><a href="reference/read_geoarrow_parquet.html">read_geoarrow_parquet</a></span><span class="op">(</span><span class="st">"nc.parquet"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 100 features and 14 fields</span>
<span class="co">#&gt; Geometry type: MULTIPOLYGON</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965</span>
<span class="co">#&gt; Geodetic CRS:  NAD27</span>
<span class="co">#&gt; # A tibble: 100 × 15</span>
<span class="co">#&gt;     AREA PERIMETER CNTY_ CNTY_ID NAME  FIPS  FIPSNO CRESS_ID BIR74 SID74 NWBIR74</span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 0.114      1.44  1825    1825 Ashe  37009  37009        5  1091     1      10</span>
<span class="co">#&gt;  2 0.061      1.23  1827    1827 Alle… 37005  37005        3   487     0      10</span>
<span class="co">#&gt;  3 0.143      1.63  1828    1828 Surry 37171  37171       86  3188     5     208</span>
<span class="co">#&gt;  4 0.07       2.97  1831    1831 Curr… 37053  37053       27   508     1     123</span>
<span class="co">#&gt;  5 0.153      2.21  1832    1832 Nort… 37131  37131       66  1421     9    1066</span>
<span class="co">#&gt;  6 0.097      1.67  1833    1833 Hert… 37091  37091       46  1452     7     954</span>
<span class="co">#&gt;  7 0.062      1.55  1834    1834 Camd… 37029  37029       15   286     0     115</span>
<span class="co">#&gt;  8 0.091      1.28  1835    1835 Gates 37073  37073       37   420     0     254</span>
<span class="co">#&gt;  9 0.118      1.42  1836    1836 Warr… 37185  37185       93   968     4     748</span>
<span class="co">#&gt; 10 0.124      1.43  1837    1837 Stok… 37169  37169       85  1612     1     160</span>
<span class="co">#&gt; # … with 90 more rows, and 4 more variables: BIR79 &lt;dbl&gt;, SID79 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   NWBIR79 &lt;dbl&gt;, geometry &lt;MULTIPOLYGON [°]&gt;</span></code></pre></div>
<p>You can use any of the schemas to experiment by passing the <code>schema</code> argument. These control how the geometry is stored in an Arrow data type (but shouldn’t affect the round trip back to R).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/write_geoarrow_parquet.html">write_geoarrow_parquet</a></span><span class="op">(</span><span class="va">nc</span>, <span class="st">"nc.parquet"</span>, schema <span class="op">=</span> <span class="fu"><a href="reference/geoarrow_schema_point.html">geoarrow_schema_wkb</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="fu">sf</span><span class="fu">::</span><span class="fu">st_as_sf</span><span class="op">(</span><span class="fu"><a href="reference/read_geoarrow_parquet.html">read_geoarrow_parquet</a></span><span class="op">(</span><span class="st">"nc.parquet"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 100 features and 14 fields</span>
<span class="co">#&gt; Geometry type: MULTIPOLYGON</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965</span>
<span class="co">#&gt; CRS:           NA</span>
<span class="co">#&gt; # A tibble: 100 × 15</span>
<span class="co">#&gt;     AREA PERIMETER CNTY_ CNTY_ID NAME  FIPS  FIPSNO CRESS_ID BIR74 SID74 NWBIR74</span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 0.114      1.44  1825    1825 Ashe  37009  37009        5  1091     1      10</span>
<span class="co">#&gt;  2 0.061      1.23  1827    1827 Alle… 37005  37005        3   487     0      10</span>
<span class="co">#&gt;  3 0.143      1.63  1828    1828 Surry 37171  37171       86  3188     5     208</span>
<span class="co">#&gt;  4 0.07       2.97  1831    1831 Curr… 37053  37053       27   508     1     123</span>
<span class="co">#&gt;  5 0.153      2.21  1832    1832 Nort… 37131  37131       66  1421     9    1066</span>
<span class="co">#&gt;  6 0.097      1.67  1833    1833 Hert… 37091  37091       46  1452     7     954</span>
<span class="co">#&gt;  7 0.062      1.55  1834    1834 Camd… 37029  37029       15   286     0     115</span>
<span class="co">#&gt;  8 0.091      1.28  1835    1835 Gates 37073  37073       37   420     0     254</span>
<span class="co">#&gt;  9 0.118      1.42  1836    1836 Warr… 37185  37185       93   968     4     748</span>
<span class="co">#&gt; 10 0.124      1.43  1837    1837 Stok… 37169  37169       85  1612     1     160</span>
<span class="co">#&gt; # … with 90 more rows, and 4 more variables: BIR79 &lt;dbl&gt;, SID79 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   NWBIR79 &lt;dbl&gt;, geometry &lt;MULTIPOLYGON&gt;</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="type-examples">Type examples<a class="anchor" aria-label="anchor" href="#type-examples"></a>
</h2>
<p>First, extension types for the kind of encodings existing libraries support already:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">geom_linestring</span> <span class="op">&lt;-</span> <span class="fu">wk</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/wk/reference/wkt.html" class="external-link">wkt</a></span><span class="op">(</span><span class="st">"LINESTRING (1 2, 2 3)"</span><span class="op">)</span>

<span class="fu">narrow</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/narrow/reference/from_narrow_array.html" class="external-link">from_narrow_array</a></span><span class="op">(</span>
  <span class="fu"><a href="reference/geoarrow_create.html">geoarrow_create</a></span><span class="op">(</span><span class="va">geom_linestring</span>, schema <span class="op">=</span> <span class="fu"><a href="reference/geoarrow_schema_point.html">geoarrow_schema_wkb</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu">arrow</span><span class="fu">::</span><span class="va"><a href="https://arrow.apache.org/docs/r//reference/array.html" class="external-link">Array</a></span>
<span class="op">)</span>
<span class="co">#&gt; Array</span>
<span class="co">#&gt; &lt;fixed_size_binary[41]&gt;</span>
<span class="co">#&gt; [</span>
<span class="co">#&gt;   010200000002000000000000000000F03F000000000000004000000000000000400000000000000840</span>
<span class="co">#&gt; ]</span>

<span class="fu">narrow</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/narrow/reference/from_narrow_array.html" class="external-link">from_narrow_array</a></span><span class="op">(</span>
  <span class="fu"><a href="reference/geoarrow_create.html">geoarrow_create</a></span><span class="op">(</span><span class="va">geom_linestring</span>, schema <span class="op">=</span> <span class="fu"><a href="reference/geoarrow_schema_point.html">geoarrow_schema_wkt</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu">arrow</span><span class="fu">::</span><span class="va"><a href="https://arrow.apache.org/docs/r//reference/array.html" class="external-link">Array</a></span>
<span class="op">)</span>
<span class="co">#&gt; Array</span>
<span class="co">#&gt; &lt;string&gt;</span>
<span class="co">#&gt; [</span>
<span class="co">#&gt;   "LINESTRING (1 2, 2 3)"</span>
<span class="co">#&gt; ]</span>

<span class="fu">narrow</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/narrow/reference/from_narrow_array.html" class="external-link">from_narrow_array</a></span><span class="op">(</span>
  <span class="fu"><a href="reference/geoarrow_create.html">geoarrow_create</a></span><span class="op">(</span><span class="va">geom_linestring</span>, schema <span class="op">=</span> <span class="fu"><a href="reference/geoarrow_schema_point.html">geoarrow_schema_geojson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu">arrow</span><span class="fu">::</span><span class="va"><a href="https://arrow.apache.org/docs/r//reference/array.html" class="external-link">Array</a></span>
<span class="op">)</span>
<span class="co">#&gt; Array</span>
<span class="co">#&gt; &lt;string&gt;</span>
<span class="co">#&gt; [</span>
<span class="co">#&gt;   "{"type":"LineString","coordinates":[[1.0,2.0],[2.0,3.0]]}"</span>
<span class="co">#&gt; ]</span></code></pre></div>
<p>…but also Arrow-native forms that don’t need to be parsed.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">geom_point</span> <span class="op">&lt;-</span> <span class="fu">wk</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/wk/reference/wkt.html" class="external-link">wkt</a></span><span class="op">(</span><span class="st">"POINT (1 2)"</span><span class="op">)</span>
<span class="va">geom_linestring</span> <span class="op">&lt;-</span> <span class="fu">wk</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/wk/reference/wkt.html" class="external-link">wkt</a></span><span class="op">(</span><span class="st">"LINESTRING (1 2, 2 3)"</span><span class="op">)</span>
<span class="va">geom_poly</span> <span class="op">&lt;-</span> <span class="fu">wk</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/wk/reference/wkt.html" class="external-link">wkt</a></span><span class="op">(</span><span class="st">"POLYGON ((0 0, 1 1, 0 1, 0 0))"</span><span class="op">)</span>
<span class="va">geom_multipoint</span> <span class="op">&lt;-</span> <span class="fu">wk</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/wk/reference/wkt.html" class="external-link">wkt</a></span><span class="op">(</span><span class="st">"MULTIPOINT (1 2)"</span><span class="op">)</span>
<span class="va">geom_multilinestring</span> <span class="op">&lt;-</span> <span class="fu">wk</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/wk/reference/wkt.html" class="external-link">wkt</a></span><span class="op">(</span><span class="st">"MULTILINESTRING ((1 2, 2 3))"</span><span class="op">)</span>
<span class="va">geom_multipoly</span> <span class="op">&lt;-</span> <span class="fu">wk</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/wk/reference/wkt.html" class="external-link">wkt</a></span><span class="op">(</span><span class="st">"MULTIPOLYGON (((0 0, 1 1, 0 1, 0 0)))"</span><span class="op">)</span>

<span class="fu">narrow</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/narrow/reference/from_narrow_array.html" class="external-link">from_narrow_array</a></span><span class="op">(</span><span class="fu"><a href="reference/geoarrow_create.html">geoarrow_create</a></span><span class="op">(</span><span class="va">geom_point</span><span class="op">)</span>, <span class="fu">arrow</span><span class="fu">::</span><span class="va"><a href="https://arrow.apache.org/docs/r//reference/array.html" class="external-link">Array</a></span><span class="op">)</span>
<span class="co">#&gt; FixedSizeListArray</span>
<span class="co">#&gt; &lt;fixed_size_list&lt;: double not null&gt;[2]&gt;</span>
<span class="co">#&gt; [</span>
<span class="co">#&gt;   [</span>
<span class="co">#&gt;     1,</span>
<span class="co">#&gt;     2</span>
<span class="co">#&gt;   ]</span>
<span class="co">#&gt; ]</span>
<span class="fu">narrow</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/narrow/reference/from_narrow_array.html" class="external-link">from_narrow_array</a></span><span class="op">(</span><span class="fu"><a href="reference/geoarrow_create.html">geoarrow_create</a></span><span class="op">(</span><span class="va">geom_linestring</span><span class="op">)</span>, <span class="fu">arrow</span><span class="fu">::</span><span class="va"><a href="https://arrow.apache.org/docs/r//reference/array.html" class="external-link">Array</a></span><span class="op">)</span>
<span class="co">#&gt; FixedSizeListArray</span>
<span class="co">#&gt; &lt;fixed_size_list&lt;: fixed_size_list&lt;: double not null&gt;[2] not null&gt;[2]&gt;</span>
<span class="co">#&gt; [</span>
<span class="co">#&gt;   [</span>
<span class="co">#&gt;     [</span>
<span class="co">#&gt;       1,</span>
<span class="co">#&gt;       2</span>
<span class="co">#&gt;     ],</span>
<span class="co">#&gt;     [</span>
<span class="co">#&gt;       2,</span>
<span class="co">#&gt;       3</span>
<span class="co">#&gt;     ]</span>
<span class="co">#&gt;   ]</span>
<span class="co">#&gt; ]</span>
<span class="fu">narrow</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/narrow/reference/from_narrow_array.html" class="external-link">from_narrow_array</a></span><span class="op">(</span><span class="fu"><a href="reference/geoarrow_create.html">geoarrow_create</a></span><span class="op">(</span><span class="va">geom_poly</span><span class="op">)</span>, <span class="fu">arrow</span><span class="fu">::</span><span class="va"><a href="https://arrow.apache.org/docs/r//reference/array.html" class="external-link">Array</a></span><span class="op">)</span>
<span class="co">#&gt; FixedSizeListArray</span>
<span class="co">#&gt; &lt;fixed_size_list&lt;: fixed_size_list&lt;: fixed_size_list&lt;: double not null&gt;[2] not null&gt;[4] not null&gt;[1]&gt;</span>
<span class="co">#&gt; [</span>
<span class="co">#&gt;   [</span>
<span class="co">#&gt;     [</span>
<span class="co">#&gt;       [</span>
<span class="co">#&gt;         0,</span>
<span class="co">#&gt;         0</span>
<span class="co">#&gt;       ],</span>
<span class="co">#&gt;       [</span>
<span class="co">#&gt;         1,</span>
<span class="co">#&gt;         1</span>
<span class="co">#&gt;       ],</span>
<span class="co">#&gt;       [</span>
<span class="co">#&gt;         0,</span>
<span class="co">#&gt;         1</span>
<span class="co">#&gt;       ],</span>
<span class="co">#&gt;       [</span>
<span class="co">#&gt;         0,</span>
<span class="co">#&gt;         0</span>
<span class="co">#&gt;       ]</span>
<span class="co">#&gt;     ]</span>
<span class="co">#&gt;   ]</span>
<span class="co">#&gt; ]</span>
<span class="fu">narrow</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/narrow/reference/from_narrow_array.html" class="external-link">from_narrow_array</a></span><span class="op">(</span><span class="fu"><a href="reference/geoarrow_create.html">geoarrow_create</a></span><span class="op">(</span><span class="va">geom_multipoint</span><span class="op">)</span>, <span class="fu">arrow</span><span class="fu">::</span><span class="va"><a href="https://arrow.apache.org/docs/r//reference/array.html" class="external-link">Array</a></span><span class="op">)</span>
<span class="co">#&gt; FixedSizeListArray</span>
<span class="co">#&gt; &lt;fixed_size_list&lt;: fixed_size_list&lt;: double not null&gt;[2] not null&gt;[1]&gt;</span>
<span class="co">#&gt; [</span>
<span class="co">#&gt;   [</span>
<span class="co">#&gt;     [</span>
<span class="co">#&gt;       1,</span>
<span class="co">#&gt;       2</span>
<span class="co">#&gt;     ]</span>
<span class="co">#&gt;   ]</span>
<span class="co">#&gt; ]</span>
<span class="fu">narrow</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/narrow/reference/from_narrow_array.html" class="external-link">from_narrow_array</a></span><span class="op">(</span><span class="fu"><a href="reference/geoarrow_create.html">geoarrow_create</a></span><span class="op">(</span><span class="va">geom_multilinestring</span><span class="op">)</span>, <span class="fu">arrow</span><span class="fu">::</span><span class="va"><a href="https://arrow.apache.org/docs/r//reference/array.html" class="external-link">Array</a></span><span class="op">)</span>
<span class="co">#&gt; FixedSizeListArray</span>
<span class="co">#&gt; &lt;fixed_size_list&lt;: fixed_size_list&lt;: fixed_size_list&lt;: double not null&gt;[2] not null&gt;[2]&gt;[1]&gt;</span>
<span class="co">#&gt; [</span>
<span class="co">#&gt;   [</span>
<span class="co">#&gt;     [</span>
<span class="co">#&gt;       [</span>
<span class="co">#&gt;         1,</span>
<span class="co">#&gt;         2</span>
<span class="co">#&gt;       ],</span>
<span class="co">#&gt;       [</span>
<span class="co">#&gt;         2,</span>
<span class="co">#&gt;         3</span>
<span class="co">#&gt;       ]</span>
<span class="co">#&gt;     ]</span>
<span class="co">#&gt;   ]</span>
<span class="co">#&gt; ]</span>
<span class="fu">narrow</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/narrow/reference/from_narrow_array.html" class="external-link">from_narrow_array</a></span><span class="op">(</span><span class="fu"><a href="reference/geoarrow_create.html">geoarrow_create</a></span><span class="op">(</span><span class="va">geom_multipoly</span><span class="op">)</span>, <span class="fu">arrow</span><span class="fu">::</span><span class="va"><a href="https://arrow.apache.org/docs/r//reference/array.html" class="external-link">Array</a></span><span class="op">)</span>
<span class="co">#&gt; FixedSizeListArray</span>
<span class="co">#&gt; &lt;fixed_size_list&lt;: fixed_size_list&lt;: fixed_size_list&lt;: fixed_size_list&lt;: double not null&gt;[2] not null&gt;[4] not null&gt;[1]&gt;[1]&gt;</span>
<span class="co">#&gt; [</span>
<span class="co">#&gt;   [</span>
<span class="co">#&gt;     [</span>
<span class="co">#&gt;       [</span>
<span class="co">#&gt;         [</span>
<span class="co">#&gt;           0,</span>
<span class="co">#&gt;           0</span>
<span class="co">#&gt;         ],</span>
<span class="co">#&gt;         [</span>
<span class="co">#&gt;           1,</span>
<span class="co">#&gt;           1</span>
<span class="co">#&gt;         ],</span>
<span class="co">#&gt;         [</span>
<span class="co">#&gt;           0,</span>
<span class="co">#&gt;           1</span>
<span class="co">#&gt;         ],</span>
<span class="co">#&gt;         [</span>
<span class="co">#&gt;           0,</span>
<span class="co">#&gt;           0</span>
<span class="co">#&gt;         ]</span>
<span class="co">#&gt;       ]</span>
<span class="co">#&gt;     ]</span>
<span class="co">#&gt;   ]</span>
<span class="co">#&gt; ]</span></code></pre></div>
<p>Collections currently fall back on WKB but could theoretically be supported using a union type:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">geom_collection</span> <span class="op">&lt;-</span> <span class="fu">wk</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/wk/reference/wkt.html" class="external-link">wkt</a></span><span class="op">(</span><span class="st">"GEOMETRYCOLLECTION (POINT (0 1), LINESTRING (1 1, 2 2))"</span><span class="op">)</span>
<span class="fu">narrow</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/narrow/reference/from_narrow_array.html" class="external-link">from_narrow_array</a></span><span class="op">(</span><span class="fu"><a href="reference/geoarrow_create.html">geoarrow_create</a></span><span class="op">(</span><span class="va">geom_collection</span><span class="op">)</span>, <span class="fu">arrow</span><span class="fu">::</span><span class="va"><a href="https://arrow.apache.org/docs/r//reference/array.html" class="external-link">Array</a></span><span class="op">)</span>
<span class="co">#&gt; Array</span>
<span class="co">#&gt; &lt;fixed_size_binary[71]&gt;</span>
<span class="co">#&gt; [</span>
<span class="co">#&gt;   01070000000200000001010000000000000000000000000000000000F03F010200000002000000000000000000F03F000000000000F03F00000000000000400000000000000040</span>
<span class="co">#&gt; ]</span></code></pre></div>
<p>The above examples all have a single feature/ring/linestring, so they fall back to using a fixed-width list. The ability to use a fixed-width list might be important if you have, say, 10 million rectangles that all have 5 points where there’s no need to store a 64-bit offset to each coordinate. For cases where there’s than <code>2 ^ 31</code> or more coordinates, the offsets will need to be 64-bit integers (i.e., large_list type). You can force either of these cases for any level of nesting by specifying a schema by hand:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">narrow</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/narrow/reference/from_narrow_array.html" class="external-link">from_narrow_array</a></span><span class="op">(</span>
  <span class="fu"><a href="reference/geoarrow_create.html">geoarrow_create</a></span><span class="op">(</span>
    <span class="va">geom_poly</span>,
    schema <span class="op">=</span> <span class="fu"><a href="reference/geoarrow_schema_point.html">geoarrow_schema_polygon</a></span><span class="op">(</span>format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"+L"</span>, <span class="st">"+l"</span><span class="op">)</span><span class="op">)</span>,
    strict <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>,
  <span class="fu">arrow</span><span class="fu">::</span><span class="va"><a href="https://arrow.apache.org/docs/r//reference/array.html" class="external-link">Array</a></span>
<span class="op">)</span>
<span class="co">#&gt; LargeListArray</span>
<span class="co">#&gt; &lt;large_list&lt;: list&lt;: fixed_size_list&lt;: double not null&gt;[2] not null&gt; not null&gt;&gt;</span>
<span class="co">#&gt; [</span>
<span class="co">#&gt;   [</span>
<span class="co">#&gt;     [</span>
<span class="co">#&gt;       [</span>
<span class="co">#&gt;         0,</span>
<span class="co">#&gt;         0</span>
<span class="co">#&gt;       ],</span>
<span class="co">#&gt;       [</span>
<span class="co">#&gt;         1,</span>
<span class="co">#&gt;         1</span>
<span class="co">#&gt;       ],</span>
<span class="co">#&gt;       [</span>
<span class="co">#&gt;         0,</span>
<span class="co">#&gt;         1</span>
<span class="co">#&gt;       ],</span>
<span class="co">#&gt;       [</span>
<span class="co">#&gt;         0,</span>
<span class="co">#&gt;         0</span>
<span class="co">#&gt;       ]</span>
<span class="co">#&gt;     ]</span>
<span class="co">#&gt;   ]</span>
<span class="co">#&gt; ]</span></code></pre></div>
<p>There are a few options for point storage. The default is to store coordinates as a fixed-width list of doubles (float64) so that coordinates stay together in memory. This is probably fastest and mirrors the way that some other formats (e.g., WKB) store coordinates.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">points</span> <span class="op">&lt;-</span> <span class="fu">wk</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/wk/reference/xy.html" class="external-link">xy</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; &lt;wk_xy[3]&gt;</span>
<span class="co">#&gt; [1] (1 4) (2 5) (3 6)</span>
<span class="va">array</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/geoarrow_create.html">geoarrow_create</a></span><span class="op">(</span><span class="va">points</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">array</span><span class="op">$</span><span class="va">array_data</span><span class="op">$</span><span class="va">children</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">buffers</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] 1 4 2 5 3 6</span></code></pre></div>
<p>Alternatively, you can store coordinates as a struct. This is much like storing x and y values in their own columns and might be useful if this is already how a user has these values in memory (e.g., the user read in a table where x and y values <em>were</em> their own columns). It also might be faster for operations like adding and dropping dimensions because the buffers stay separate for each dimension.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">array</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/geoarrow_create.html">geoarrow_create</a></span><span class="op">(</span><span class="va">points</span>, schema <span class="op">=</span> <span class="fu"><a href="reference/geoarrow_schema_point.html">geoarrow_schema_point_struct</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">array</span><span class="op">$</span><span class="va">array_data</span><span class="op">$</span><span class="va">children</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">buffers</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] 1 2 3</span>
<span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">array</span><span class="op">$</span><span class="va">array_data</span><span class="op">$</span><span class="va">children</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">buffers</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] 4 5 6</span></code></pre></div>
<p>For both of these, it might be adequate to store values as float32 instead of float64. I didn’t implement that here yet but in theory it shouldn’t be a problem.</p>
<p>These are far from an exhaustive list of how coordinates can be stored. For example, S2 cell IDs (64-bit integers with ~1 cm resolution describing a location on the globe) are a fast and compact way to encode geographic coordinates. The H3 library has a similar scheme where each 64-bit integer describes a hexagon on the sphere. Some libraries use 32-bit integers scaled by 1e6 to represent longitude and latitude, and some provide an exact decimal type to skirt around floating point precision issues, particularly for internal calculations (e.g., decimal128 or decimal256).</p>
<p>It might not be worth supporting all the point storage formats in any particular implementation; however, the format is such that the coordinate array can be swapped out independent of the rest of the array structure.</p>
</div>
<div class="section level2">
<h2 id="why-so-many-options">Why so many options?<a class="anchor" aria-label="anchor" href="#why-so-many-options"></a>
</h2>
<p>The options are provided here so that implementations can experiment to see if more than one is worth supporting.</p>
</div>
<div class="section level2">
<h2 id="metadata">Metadata<a class="anchor" aria-label="anchor" href="#metadata"></a>
</h2>
<p>The schemas here use column-level extension types and extension metadata to encode dimension names, CRS information, and a flag to specify that edges should be considered geodesic rather than Cartesian.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/geoarrow_schema_point.html">geoarrow_schema_linestring</a></span><span class="op">(</span>
  geodesic <span class="op">=</span> <span class="cn">TRUE</span>,
  point <span class="op">=</span> <span class="fu"><a href="reference/geoarrow_schema_point.html">geoarrow_schema_point</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"OGC:CRS84"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">schema</span><span class="op">$</span><span class="va">metadata</span><span class="op">[[</span><span class="st">"ARROW:extension:name"</span><span class="op">]</span><span class="op">]</span>
<span class="co">#&gt; [1] "geoarrow.linestring"</span>
<span class="fu"><a href="reference/geoarrow_metadata.html">geoarrow_metadata</a></span><span class="op">(</span><span class="va">schema</span><span class="op">)</span>
<span class="co">#&gt; $geodesic</span>
<span class="co">#&gt; [1] "true"</span>
<span class="fu"><a href="reference/geoarrow_metadata.html">geoarrow_metadata</a></span><span class="op">(</span><span class="va">schema</span><span class="op">$</span><span class="va">children</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; $crs</span>
<span class="co">#&gt; [1] "OGC:CRS84"</span>
<span class="co">#&gt;</span>
<span class="co">#&gt; $dim</span>
<span class="co">#&gt; [1] "xy"</span></code></pre></div>
<p>I would argue that any string recognized by the latest PROJ release as a CRS is valid for the <code>crs</code> item (which lives with the point array). This includes full WKT2 output, which provides more detail at the expense of including redundant information that can get out of sync. I think “OGC:CRS84” or “EPSG:32620” are no less exact but are perhaps imprecise in a way I don’t yet understand.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing geoarrow</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Dewey Dunnington <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-9415-4582" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/paleolimbot/geoarrow/actions" class="external-link"><img src="https://github.com/paleolimbot/geoarrow/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://codecov.io/gh/paleolimbot/geoarrow?branch=master" class="external-link"><img src="https://codecov.io/gh/paleolimbot/geoarrow/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Dewey Dunnington.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
